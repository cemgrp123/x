<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muhasebe Yönetimi</title>
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/muhasebe.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


</head>

<body>
    <nav class="navbar">
        <div class="container">
            <a href="#" class="logo">Gültepe Yemekhane Yönetimi</a>

            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>

            <div class="nav-links" id="navLinks">
                <a href="admin.html#">Ana Sayfa</a>
                <a href="ogrenciler.html#">Öğrenciler</a>
                <a href="muhasebe.html">Muhasebe</a>

                <!-- Birinci Dropdown Menü -->
                <div class="dropdown">
                    <button class="dropdown-btn">
                        Menü <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-content">
                        <a href="menuolustur.html#">Menü Yap</a>
                        <a href="menu.html">Menü Gramaj</a>
                        <a href="yazdırmenu.html#">Menü Yazdır</a>
                        <a href="aylikgidmik.html#">Menü Maliyet</a>
                    </div>
                </div>

                <!-- İkinci Dropdown Menü -->
                <div class="dropdown">
                    <button class="dropdown-btn">
                        Veri Tabanı <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-content">
                        <a href="raporlar.html#">Raporlar</a>
                        <a href="tutarlar.html#">Yıllık Tutarlar</a>
                         <a href="gecisler.html">Geçişler</a>


                    </div>
                </div>


            </div>
        </div>
    </nav>

    <div class="container py-4">
        <h2 class="section-title">Muhasebe Yönetimi</h2>
        <div class="row g-4 mb-4">
            <div class="col-md-6 col-lg-3">
                <div class="stat-card total-card">
                    <i class="bi bi-currency-exchange"></i>
                    <h5>Aylık Gelirler</h5>
                    <p id="amountBox1" class="total-amount">₺ 0.00</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="stat-card expense-card">
                    <i class="bi bi-graph-down"></i>
                    <h5>Toplam Giderler</h5>
                    <p id="amountBox2" class="total-amount">₺ 0.00</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="stat-card income-card">
                    <i class="bi bi-graph-up"></i>
                    <h5>Günlük Gelirler</h5>
                    <p id="amountBox3" class="total-amount">₺ 0.00</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="stat-card expected-card">
                    <div class="profit-percentage-badge">
                        <span id="profitPercentage">+0%</span>
                    </div>
                    <i class="bi bi-hourglass-split"></i>
                    <h5>Toplam Kâr</h5>
                    <p id="amountBox5" class="total-amount">₺ 0.00</p>
                </div>
            </div>
        </div>
        <!-- Toplam ödeme özeti -->
        <div class="payment-summary-container">
            <div class="row g-3">
                <div class="col-md-3">
                    <div class="payment-summary-card ">
                        <div class="summary-icon text-success">
                            <i class="bi bi-hourglass"></i>
                        </div>
                        <div class="summary-content">
                            <h6>Bu Ay Beklenen Ödemeler</h6>
                            <div class="summary-amount text-success" id="toplamTutarGenel">₺75,000.00</div>
                            <div class="summary-count" id="toplamOgrenciGenel">40 Öğrenci</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="payment-summary-card pending-summary">
                        <div class="summary-icon">
                            <i class="bi bi-hourglass"></i>
                        </div>
                        <div class="summary-content">
                            <h6>Bekleyen Ödemeler</h6>
                            <div class="summary-amount" id="bekleyenToplam">₺900.00</div>
                            <div class="summary-count" id="bekleyenOgrenciSayisi">2 Öğrenci</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="payment-summary-card overdue-summary">
                        <div class="summary-icon">
                            <i class="bi bi-exclamation-triangle"></i>
                        </div>
                        <div class="summary-content">
                            <h6>Gecikmiş Ödemeler</h6>
                            <div class="summary-amount" id="gecikmisToplam">₺900.00</div>
                            <div class="summary-count" id="gecikmisOgrenciSayisi">2 Öğrenci</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="payment-summary-card grand-total">
                        <div class="summary-icon">
                            <i class="bi bi-cash-stack"></i>
                        </div>
                        <div class="summary-content">
                            <h6>Gelen Ödeme Toplam</h6>
                            <div class="summary-amount" id="odendiToplam">₺1,800.00</div>
                            <div class="summary-count" id="odendiOgrenciSayisi">4 Öğrenci</div>
                        </div>
                    </div>
                </div>
                <button id="gecikmeButonu" class="btn btn-danger mb-3">Bekleyenleri Gecikmiş Yap</button>

            </div>
        </div>
        <div class="row g-4">
            <div class="col-lg-12">
                <div class="card card-custom">
                    <h4 class="text-center"><i class="bi bi-hourglass"></i> Ödemeler</h4>

                    <div class="mb-3">
                        <label for="selectAy" class="form-label">Ay Seçiniz:</label>
                        <select id="selectAy" class="form-select w-auto">
                            <option value="eylul">Eylül</option>
                            <option value="ekim">Ekim</option>
                            <option value="kasim">Kasım</option>
                            <option value="aralik">Aralık</option>
                            <option value="ocak">Ocak</option>
                            <option value="subat">Şubat</option>
                            <option value="mart">Mart</option>
                            <option value="nisan">Nisan</option>
                            <option value="mayis">Mayıs</option>
                        </select>
                    </div>

                    <div class="search-container mb-3">
                        <i class="bi bi-search"></i>
                        <input type="text" id="searchExpectedInput" class="form-control"
                            placeholder="Öğrenci, Okul No veya Sınıf Ara...">
                    </div>

                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead>
                                <tr>
                                    <th>Son Tarih</th>
                                    <th>Öğrenci</th>
                                    <th>Sınıf</th>
                                    <th>Tutar</th>
                                    <th>Durum</th>
                                    <th>İşlem</th>
                                    <th>Ödeme</th>

                                </tr>
                            </thead>
                            <tbody id="expectedPaymentList">
                                <!-- Dinamik dolacak -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>


            <div class="row g-4">
                <div class="col-lg-6">
                    <div class="card card-custom">
                        <h4 class="text-center"><i class="bi bi-cash-coin"></i> Günlük Gelirler</h4>
                        <div class="row g-2 mb-3">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-calendar"></i></span>
                                    <input type="date" id="dateInput1" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-card-text"></i></span>
                                    <input type="text" id="descInput1" class="form-control" placeholder="Açıklama">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-text">₺</span>
                                    <input type="number" id="amountInput1" class="form-control" placeholder="Tutar">
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-primary w-100 mb-3" onclick="addIncome()">
                            <i class="bi bi-plus-circle"></i> Gelir Ekle
                        </button>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Tarih</th>
                                        <th>Açıklama</th>
                                        <th>Tutar</th>
                                        <th>İşlem</th>
                                    </tr>
                                </thead>
                                <tbody id="incomeList">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="card card-custom">
                        <h4 class="text-center"><i class="bi bi-cart-dash"></i> Günlük Giderler</h4>
                        <div class="row g-2 mb-3">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-calendar"></i></span>
                                    <input type="date" id="dateInput2" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-card-text"></i></span>
                                    <input type="text" id="descInput2" class="form-control" placeholder="Açıklama">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-text">₺</span>
                                    <input type="number" id="amountInput2" class="form-control" placeholder="Tutar">
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-danger w-100 mb-3" onclick="addExpense()">
                            <i class="bi bi-dash-circle"></i> Gider Ekle
                        </button>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Tarih</th>
                                        <th>Açıklama</th>
                                        <th>Tutar</th>
                                        <th>İşlem</th>
                                    </tr>
                                </thead>
                                <tbody id="expenseList">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Toast Container -->
        <div id="toast-container" class="toast-container position-fixed top-0 start-50 translate-middle-x pt-3"
            style="z-index: 9999; pointer-events: none; width: auto; max-width: 350px;">
        </div>




        <script src="js/navbar.js"></script>
        <script src="js/muhasebe.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            // TÜRK LİRASI FORMATLAMA FONKSİYONU (Tüm kutular için)
            function formatTurkishLira(amount) {
                const num = Number(amount);
                if (isNaN(num)) return '₺0,00';

                const options = {
                    style: 'currency',
                    currency: 'TRY',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                };

                return num.toLocaleString('tr-TR', options)
                    .replace('₺', '₺ ')
                    .replace(/\s+/g, ' ');
            }

            // TOPLAM KÂR HESAPLAMA VE FORMATLAMA
            function updateProfitDisplay() {
                try {
                    // Değerleri sayfadan al ve temizle
                    const parseMoney = (text) => {
                        return parseFloat(text.replace(/[^\d.-]/g, '')) || 0;
                    };

                    const monthlyIncome = parseMoney(document.getElementById('amountBox1').textContent);
                    const dailyIncome = parseMoney(document.getElementById('amountBox3').textContent);
                    const totalExpenses = parseMoney(document.getElementById('amountBox2').textContent);

                    // Hesaplamalar
                    const totalProfit = monthlyIncome + dailyIncome - totalExpenses;
                    const profitPercent = totalExpenses > 0 ? (totalProfit / totalExpenses) * 100 : 0;

                    // Toplam Kâr'ı güncelle (ÖZEL ÇÖZÜM)
                    const profitBox = document.getElementById('amountBox5');
                    profitBox.textContent = formatTurkishLira(totalProfit);

                    // Yüzdeyi güncelle
                    const percentElement = document.getElementById('profitPercentage');
                    percentElement.textContent = `${profitPercent >= 0 ? '+' : ''}${profitPercent.toFixed(1)}%`;
                    percentElement.style.backgroundColor = profitPercent >= 0 ? '#28a745' : '#dc3545';

                } catch (error) {
                    console.error('Hesaplama hatası:', error);
                }
            }

            // SAYFA YÜKLENDİĞİNDE VE HER 2 SANİYEDE BİR ÇALIŞTIR
            document.addEventListener('DOMContentLoaded', () => {
                updateProfitDisplay();
                setInterval(updateProfitDisplay, 2000);
            });

            // VERİ DEĞİŞTİĞİNDE MANUEL ÇAĞIRMA
            function refreshFinancialData() {
                updateProfitDisplay();
            }

        </script>

</body>

</html>